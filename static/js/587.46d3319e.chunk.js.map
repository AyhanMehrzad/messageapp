{"version":3,"file":"static/js/587.46d3319e.chunk.js","mappings":"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","sources":["components/ChatWindow.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nconst Message = ({ msg, user, setReplyTo }) => {\n  const isMe = msg.user === user;\n\n  // Helper to detect RTL characters (Arabic, Persian, Hebrew)\n  const isRTL = (text) => {\n    const rtlChar = /[\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC]/;\n    return rtlChar.test(text);\n  };\n\n  const renderContent = () => {\n    switch (msg.type) {\n      case 'image':\n        return <img src={msg.msg} alt=\"attachment\" className=\"msg-image\" />;\n      case 'video':\n        return <video src={msg.msg} controls className=\"msg-video\" />;\n      case 'audio':\n        return <audio src={msg.msg} controls className=\"msg-audio\" />;\n      case 'file':\n        // Extract filename from URL if possible, else generic\n        const filename = msg.msg.split('/').pop().split('_').slice(2).join('_');\n        return (\n          <a href={msg.msg} target=\"_blank\" rel=\"noopener noreferrer\" className=\"msg-file\">\n            ðŸ“„ {filename || 'Download File'}\n          </a>\n        );\n      default:\n        const direction = isRTL(msg.msg) ? 'rtl' : 'ltr';\n        return <div className=\"msg-text\" style={{ direction: direction, textAlign: direction === 'rtl' ? 'right' : 'left' }}>{msg.msg}</div>;\n    }\n  };\n\n  return (\n    <div className={`message ${isMe ? 'me' : 'other'} ${msg.type}`}>\n      {/* Reply Context - Telegram Style */}\n      {msg.reply_context && (\n        <div className=\"message-reply-context\" onClick={() => {\n          // Optional: scroll to message if in view\n        }}>\n          <div className=\"reply-line\"></div>\n          <div className=\"reply-content\">\n            {/* Removed specific username, generic label or just text */}\n            <div className=\"reply-author\">Replying to message</div>\n            <div className=\"reply-text\">\n              {msg.reply_context.type === 'text' ? msg.reply_context.msg : `[${msg.reply_context.type}]`}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"msg-content-wrapper\">\n        {renderContent()}\n      </div>\n\n      {/* Time (Simulated or from timestamp) */}\n      <div className=\"msg-time\">\n        {new Date(msg.timestamp * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n      </div>\n\n      {/* Reply Button */}\n      <button\n        className=\"reply-btn\"\n        onClick={() => setReplyTo(msg)}\n        title=\"Reply\"\n      >\n        â†©\n      </button>\n    </div>\n  );\n};\n\nconst ChatWindow = ({ messages, user, setReplyTo, onLoadMore }) => {\n  const chatWindowRef = useRef(null);\n  const scrollSentinelRef = useRef(null);\n  const [shouldAutoScroll, setShouldAutoScroll] = useState(true);\n  const [isLoadingHistory, setIsLoadingHistory] = useState(false);\n\n  // Check if we should auto-scroll before updates\n  const handleScroll = () => {\n    if (chatWindowRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = chatWindowRef.current;\n      const isNearBottom = scrollHeight - scrollTop - clientHeight < 100;\n      setShouldAutoScroll(isNearBottom);\n\n      // Infinite Scroll: Load more when near top\n      if (scrollTop < 50 && !isLoadingHistory && messages.length > 0) {\n        setIsLoadingHistory(true);\n        // Find oldest message timestamp\n        const oldestMsg = messages[0];\n        if (oldestMsg && onLoadMore) {\n          onLoadMore(oldestMsg.timestamp).finally(() => {\n            setIsLoadingHistory(false);\n          });\n        }\n      }\n    }\n  };\n\n  // Effect to handle auto-scrolling\n  useEffect(() => {\n    if (shouldAutoScroll && scrollSentinelRef.current) {\n      scrollSentinelRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages, shouldAutoScroll]);\n\n  return (\n    <div\n      className=\"chat-window\"\n      ref={chatWindowRef}\n      onScroll={handleScroll}\n    >\n      {isLoadingHistory && <div className=\"loading-history\">Loading history...</div>}\n\n      {messages.map((msg, index) => (\n        <Message\n          key={msg.id || `${msg.timestamp}-${index}`}\n          msg={msg}\n          user={user}\n          setReplyTo={setReplyTo}\n        />\n      ))}\n      <div ref={scrollSentinelRef} className=\"chat-spacer\"></div>\n    </div>\n  );\n};\n\nexport default ChatWindow;\n"],"names":["Message","_ref","msg","user","setReplyTo","isMe","_jsxs","className","concat","type","children","reply_context","onClick","_jsx","renderContent","src","alt","controls","filename","split","pop","slice","join","href","target","rel","direction","text","test","style","textAlign","Date","timestamp","toLocaleTimeString","hour","minute","title","_ref2","messages","onLoadMore","chatWindowRef","useRef","scrollSentinelRef","shouldAutoScroll","setShouldAutoScroll","useState","isLoadingHistory","setIsLoadingHistory","useEffect","current","scrollIntoView","behavior","ref","onScroll","handleScroll","scrollTop","scrollHeight","clientHeight","length","oldestMsg","finally","map","index","id"],"ignoreList":[],"sourceRoot":""}