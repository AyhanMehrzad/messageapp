"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[640],{640:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var n=r(43),c=r(579);const a=e=>{let{onSend:t,onSocketAction:r}=e;const[a,i]=(0,n.useState)(""),[s,l]=(0,n.useState)(!1),[o,u]=(0,n.useState)(null),[d,m]=(0,n.useState)(0),[p,h]=(0,n.useState)(!1),[v,f]=(0,n.useState)("user"),g=(0,n.useRef)(null),b=(0,n.useRef)(null),x=(0,n.useRef)([]),w=(0,n.useRef)(null),y=(0,n.useRef)(null),j=(0,n.useRef)(null),k=(0,n.useRef)(null),N=(0,n.useRef)(null),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{g.current&&(g.current.style.height="auto",g.current.style.height=g.current.scrollHeight+"px")},[a]),(0,n.useEffect)(()=>()=>{S()},[]);const S=(0,n.useCallback)(()=>{N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),C.current&&(cancelAnimationFrame(C.current),C.current=null)},[]),R=()=>{a.trim()&&(t(a),i(""),g.current&&(g.current.style.height="auto",g.current.focus()))},T=()=>{if(j.current&&k.current&&!j.current.paused&&!j.current.ended){k.current.getContext("2d").drawImage(j.current,0,0,k.current.width,k.current.height),C.current=requestAnimationFrame(T)}},M=async e=>{try{let t;S();let r="audio/webm",n="webm";if("video"===e){const e={video:{facingMode:v},audio:!0},c=await navigator.mediaDevices.getUserMedia(e);if(N.current=c,k.current&&j.current){j.current.srcObject=c,await j.current.play(),k.current.width=j.current.videoWidth,k.current.height=j.current.videoHeight,T();const e=k.current.captureStream(30),a=c.getAudioTracks()[0];a&&e.addTrack(a),t=e,r=(()=>{const e=["video/mp4","video/webm;codecs=h264","video/webm"];for(const t of e)if(MediaRecorder.isTypeSupported(t))return t;return"video/webm"})(),n=r.includes("mp4")?"mp4":"webm"}}else{const e=await navigator.mediaDevices.getUserMedia({audio:!0});N.current=e,t=e,r="audio/webm"}const c=new MediaRecorder(t,{mimeType:r});b.current=c,x.current=[],c.ondataavailable=e=>{e.data.size>0&&x.current.push(e.data)},c.onstop=()=>{const t=new Blob(x.current,{type:r});U(t,e,n),S()},c.start(),l(!0),u(e),m(0),w.current=setInterval(()=>{m(e=>e+1)},1e3)}catch(t){console.error("Error accessing media devices:",t),alert("Could not access camera/microphone. Please check permissions.")}},D=async()=>{if("video"===o&&N.current){const t="user"===v?"environment":"user";f(t);try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:t}}),r=N.current.getVideoTracks()[0];r&&r.stop(),j.current.srcObject=e,await j.current.play();const n=e.getVideoTracks()[0];N.current.addTrack(n),N.current.removeTrack(r)}catch(e){console.error("Error switching camera:",e)}}},E=()=>{b.current&&s&&(b.current.stop(),l(!1),u(null),clearInterval(w.current))},I=()=>{b.current&&s&&(b.current.onstop=null,b.current.stop(),S(),l(!1),u(null),clearInterval(w.current))},U=async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webm";h(!0);const c=new FormData,a="image"===r?e.name||"image.png":"recording.".concat(n),i=e.name||a;c.append("file",e,i);try{const e=await fetch("/api/upload",{method:"POST",body:c}),n=await e.json();n.url&&t({msg:n.url,type:r})}catch(s){console.error("Upload failed",s),alert("Upload failed.")}finally{h(!1),y.current&&(y.current.value="")}},A=e=>{const t=Math.floor(e/60),r=e%60;return"".concat(t,":").concat(r<10?"0":"").concat(r)},F=e=>{r&&r(e)};return s?(0,c.jsxs)("div",{className:"input-container recording-mode",children:[(0,c.jsx)("video",{ref:j,style:{display:"none"},playsInline:!0,muted:!0,autoPlay:!0}),"video"===o&&(0,c.jsxs)("div",{className:"video-preview-circle-container",children:[(0,c.jsx)("canvas",{ref:k,className:"video-preview-feed-circle"}),(0,c.jsx)("button",{className:"btn-switch-camera",onClick:D,style:{position:"absolute",bottom:"20px",right:"50%",transform:"translateX(50%)",zIndex:3e3,background:"rgba(0,0,0,0.5)",color:"white",border:"1px solid white",borderRadius:"20px",padding:"5px 15px",cursor:"pointer"},children:"\ud83d\udd04 Flip"})]}),(0,c.jsxs)("div",{className:"recording-status",children:[(0,c.jsx)("span",{className:"rec-dot"}),(0,c.jsx)("span",{className:"rec-time",children:A(d)})]}),(0,c.jsxs)("div",{className:"recording-controls",children:[(0,c.jsx)("button",{className:"btn-cancel-rec",onClick:I,children:"Cancel"}),(0,c.jsx)("button",{className:"btn-send-rec",onClick:E,children:"Stop & Send"})]})]}):(0,c.jsxs)("div",{className:"message-input-stack",children:[(0,c.jsxs)("div",{className:"action-bar-pill",children:[(0,c.jsx)("div",{className:"action-unit",onClick:()=>F("clear"),children:"\ud83d\uddd1\ufe0f"}),(0,c.jsx)("div",{className:"action-unit",onClick:()=>F("ping"),children:"\ud83d\udd14"}),(0,c.jsx)("div",{className:"action-unit",onClick:()=>{return e="\ud83d\ude0a",void i(t=>t+e);var e},children:"\ud83d\ude0a"}),(0,c.jsx)("div",{className:"action-unit",onClick:()=>F("exit"),children:"\ud83d\udcfa"})]}),(0,c.jsxs)("div",{className:"input-pill-container",children:[(0,c.jsx)("input",{type:"file",ref:y,style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){let e="file",r=t.name.split(".").pop();t.type.startsWith("image/")?e="image":t.type.startsWith("video/")?e="video":t.type.startsWith("audio/")&&(e="audio"),U(t,e,r)}},accept:"image/*,video/*,audio/*,.pdf,.doc,.docx"}),(0,c.jsxs)("div",{className:"input-pill-box",children:[(0,c.jsx)("button",{className:"pin-btn",onClick:()=>y.current.click(),children:"\ud83d\udcce"}),(0,c.jsx)("textarea",{ref:g,className:"input-field-pill",placeholder:"Message...",value:a,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},rows:1,disabled:p}),a.trim()?(0,c.jsx)("button",{className:"send-btn-pill",onClick:R,disabled:p,children:p?"...":"\u27a4"}):(0,c.jsxs)("div",{className:"media-actions-pill",children:[(0,c.jsx)("button",{className:"media-btn-pill video-btn",onClick:()=>M("video"),disabled:p,children:"\ud83d\udcf9"}),(0,c.jsx)("button",{className:"media-btn-pill mic-btn",onClick:()=>M("audio"),disabled:p,children:"\ud83c\udfa4"})]})]})]})]})}}}]);
//# sourceMappingURL=640.ea3394ed.chunk.js.map