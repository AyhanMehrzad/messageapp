"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[377],{3377:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var n=s(5043),r=s(4930),i=s(293),o=s(9565),a=s(3077),c=s(7070);function l(e,t){[...t].reverse().forEach(s=>{const n=e.getVariant(s);n&&(0,a.U)(e,n),e.variantChildren&&e.variantChildren.forEach(e=>{l(e,t)})})}function d(){let e=!1;const t=new Set,s={subscribe:e=>(t.add(e),()=>{t.delete(e)}),start(s,n){(0,o.V)(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const r=[];return t.forEach(e=>{r.push((0,c._)(e,s,{transitionOverride:n}))}),Promise.all(r)},set:s=>((0,o.V)(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach(e=>{!function(e,t){Array.isArray(t)?l(e,t):"string"===typeof t?l(e,[t]):(0,a.U)(e,t)}(e,s)})),stop(){t.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>(e=!0,()=>{e=!1,s.stop()})};return s}const u=function(){const e=(0,r.M)(d);return(0,i.E)(e.mount,[]),e};var m=s(7189),h=s(1051);function g(e){const t=(0,r.M)(()=>(0,m.OQ)(e)),{isStatic:s}=(0,n.useContext)(h.Q);if(s){const[,s]=(0,n.useState)(e);(0,n.useEffect)(()=>t.on("change",s),[])}return t}var p=s(6744);var f=s(8412);function x(e,t){const s=g(t()),n=()=>s.set(t());return n(),(0,i.E)(()=>{const t=()=>f.Gt.preRender(n,!1,!0),s=e.map(e=>e.on("change",t));return()=>{s.forEach(e=>e()),(0,f.WG)(n)}}),s}function v(e,t,s,n){if("function"===typeof e)return function(e){m.bt.current=[],e();const t=x(m.bt.current,e);return m.bt.current=void 0,t}(e);const r="function"===typeof t?t:function(){const e=!Array.isArray(arguments.length<=0?void 0:arguments[0]),t=e?0:-1,s=0+t<0||arguments.length<=0+t?void 0:arguments[0+t],n=1+t<0||arguments.length<=1+t?void 0:arguments[1+t],r=2+t<0||arguments.length<=2+t?void 0:arguments[2+t],i=3+t<0||arguments.length<=3+t?void 0:arguments[3+t],o=(0,p.G)(n,r,i);return e?o(s):o}(t,s,n);return Array.isArray(e)?y(e,r):y([e],e=>{let[t]=e;return r(t)})}function y(e,t){const s=(0,r.M)(()=>[]);return x(e,()=>{s.length=0;const n=e.length;for(let t=0;t<n;t++)s[t]=e[t].get();return t(s)})}var j=s(4119),N=s(9570),w=s(579);const k=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 20 16",fill:"none",className:"msg-check double",children:[(0,w.jsx)("path",{d:"M13.5 4.5L6.5 11.5L3 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,w.jsx)("path",{d:"M17.5 4.5L10.5 11.5L8 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.6"})]}),E=e=>{let{msg:t,user:s,setReplyTo:r,onContextMenu:i}=e;const o=t.user===s,a=u(),c=g(0),l=(v(c,[-100,0],[0,1]),e=>{let{text:t}=e;const[s,r]=(0,n.useState)(!1);return(0,w.jsx)("span",{className:"spoiler ".concat(s?"revealed":""),onClick:e=>{e.stopPropagation(),r(!0)},children:t})}),d=e=>e.split(/(\|\|.*?\|\|)/g).map((e,t)=>e.startsWith("||")&&e.endsWith("||")?(0,w.jsx)(l,{text:e.slice(2,-2)},t):e);return(0,w.jsx)("div",{className:"message-row",style:{display:"flex",position:"relative",flexDirection:"column",alignItems:o?"flex-end":"flex-start"},children:(0,w.jsxs)(j.P.div,{className:"message ".concat(o?"me":"other"," ").concat(t.type),drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:.5,right:0},onDragEnd:(e,s)=>{s.offset.x<-60?(navigator.vibrate&&navigator.vibrate(10),r(t),a.start({x:0})):a.start({x:0})},animate:a,whileDrag:{scale:.98},children:[(0,w.jsx)(j.P.div,{style:{position:"absolute",right:-40,top:"50%",y:"-50%",opacity:v(c,[-60,0],[1,0])},children:"\u21a9"}),t.reply_context&&(0,w.jsxs)("div",{className:"message-reply-context",children:[(0,w.jsx)("div",{className:"reply-line"}),(0,w.jsxs)("div",{className:"reply-content",children:[(0,w.jsx)("div",{className:"reply-author",children:"Replying to"}),(0,w.jsx)("div",{className:"reply-text",children:"text"===t.reply_context.type?t.reply_context.msg:"[".concat(t.reply_context.type,"]")})]})]}),(0,w.jsx)("div",{className:"msg-content-wrapper",children:(()=>{switch(t.type){case"image":return(0,w.jsx)("img",{src:t.msg,alt:"attachment",className:"msg-image"});case"video":return(0,w.jsxs)("div",{className:"video-msg-wrapper",style:{position:"relative",display:"inline-block"},children:[(0,w.jsx)("video",{src:t.msg,controls:!0,className:"msg-video"}),(0,w.jsx)("a",{href:t.msg,download:!0,className:"video-download-btn",children:"\u2b07"})]});case"audio":return(0,w.jsx)("audio",{src:t.msg,controls:!0,className:"msg-audio"});case"file":const s=t.msg.split("/").pop().split("_").slice(2).join("_");return(0,w.jsxs)("a",{href:t.msg,target:"_blank",rel:"noopener noreferrer",className:"msg-file",children:["\ud83d\udcc4 ",s||"Download File"]});default:const n=(e=t.msg,/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(e)?"rtl":"ltr");return(0,w.jsx)("div",{className:"msg-text",style:{direction:n,textAlign:"rtl"===n?"right":"left"},children:d(t.msg)})}var e})()}),(0,w.jsxs)("div",{className:"msg-meta",children:[(0,w.jsx)("span",{className:"msg-time",children:new Date(1e3*t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),o&&(0,w.jsx)("span",{className:"msg-status",children:(0,w.jsx)(k,{})})]})]})})},C=e=>{let{messages:t,user:s,setReplyTo:r,onLoadMore:i}=e;const o=(0,n.useRef)(null),a=(0,n.useRef)(null),[c,l]=(0,n.useState)(!0),[d,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{c&&a.current&&a.current.scrollIntoView({behavior:"smooth"})},[t,c]);const[m,h]=(0,n.useState)(null),g=()=>h(null);return(0,n.useEffect)(()=>{const e=()=>h(null);return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]),(0,w.jsxs)("div",{className:"chat-window",ref:o,onScroll:()=>{if(o.current){const{scrollTop:e,scrollHeight:s,clientHeight:n}=o.current;if(l(s-e-n<100),e<50&&!d&&t.length>0){u(!0);const e=t[0];e&&i&&i(e.timestamp).finally(()=>{u(!1)})}}},children:[d&&(0,w.jsx)("div",{className:"loading-history",children:"Loading history..."}),t.map((e,t)=>(0,w.jsx)(E,{msg:e,user:s,setReplyTo:r,onContextMenu:t=>((e,t)=>{e.preventDefault();let s=e.clientX,n=e.clientY;const r=window.innerWidth,i=window.innerHeight;s+150>r&&(s=r-150-10),n+120>i&&(n=i-120-10),h({x:s,y:n,msg:t})})(t,e)},e.id||"".concat(e.timestamp,"-").concat(t))),(0,w.jsx)("div",{ref:a,className:"chat-spacer"}),(0,w.jsx)(N.N,{children:m&&(0,w.jsxs)(j.P.div,{className:"custom-context-menu",style:{top:m.y,left:m.x},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:300,damping:20},children:[(0,w.jsx)("div",{className:"menu-item",onClick:()=>{r(m.msg),g()},children:"\u21a9 Reply"}),(0,w.jsx)("div",{className:"menu-item",onClick:()=>{navigator.clipboard.writeText(m.msg.msg),g()},children:"\ud83d\udccb Copy"}),(0,w.jsx)("div",{className:"menu-item",onClick:()=>g(),children:"\u270f\ufe0f Edit"}),(0,w.jsx)("div",{className:"menu-item",onClick:()=>g(),children:"\u27a1\ufe0f Forward"}),(0,w.jsx)("div",{className:"menu-item delete",onClick:()=>g(),children:"\ud83d\uddd1\ufe0f Delete"})]})})]})}}}]);
//# sourceMappingURL=377.026b5c66.chunk.js.map