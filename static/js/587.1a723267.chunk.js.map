{"version":3,"file":"static/js/587.1a723267.chunk.js","mappings":"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","sources":["components/ChatWindow.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nconst Message = ({ msg, user, setReplyTo }) => {\n  const isMe = msg.user === user;\n\n  // Helper to detect RTL characters (Arabic, Persian, Hebrew)\n  const isRTL = (text) => {\n    const rtlChar = /[\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC]/;\n    return rtlChar.test(text);\n  };\n\n  const renderContent = () => {\n    switch (msg.type) {\n      case 'image':\n        return <img src={msg.msg} alt=\"attachment\" className=\"msg-image\" />;\n      case 'video':\n        return (\n          <div className=\"video-msg-wrapper\" style={{ position: 'relative', display: 'inline-block' }}>\n            <video src={msg.msg} controls className=\"msg-video\" />\n            <a\n              href={msg.msg}\n              download\n              className=\"video-download-btn\"\n              title=\"Download Video\"\n              style={{\n                position: 'absolute',\n                bottom: '0',\n                right: '0',\n                background: 'var(--accent-primary)',\n                color: 'var(--bg-color)',\n                width: '32px',\n                height: '32px',\n                borderRadius: '50%',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                boxShadow: '0 2px 5px rgba(0,0,0,0.3)',\n                zIndex: 5\n              }}\n            >\n              â¬‡\n            </a>\n          </div>\n        );\n      case 'audio':\n        return <audio src={msg.msg} controls className=\"msg-audio\" />;\n      case 'file':\n        // Extract filename from URL if possible, else generic\n        const filename = msg.msg.split('/').pop().split('_').slice(2).join('_');\n        return (\n          <a href={msg.msg} target=\"_blank\" rel=\"noopener noreferrer\" className=\"msg-file\">\n            ðŸ“„ {filename || 'Download File'}\n          </a>\n        );\n      default:\n        const direction = isRTL(msg.msg) ? 'rtl' : 'ltr';\n        return <div className=\"msg-text\" style={{ direction: direction, textAlign: direction === 'rtl' ? 'right' : 'left' }}>{msg.msg}</div>;\n    }\n  };\n\n  return (\n    <div className={`message ${isMe ? 'me' : 'other'} ${msg.type}`}>\n      {/* Reply Context - Telegram Style */}\n      {msg.reply_context && (\n        <div className=\"message-reply-context\" onClick={() => {\n          // Optional: scroll to message if in view\n        }}>\n          <div className=\"reply-line\"></div>\n          <div className=\"reply-content\">\n            {/* Removed specific username, generic label or just text */}\n            <div className=\"reply-author\">Replying to message</div>\n            <div className=\"reply-text\">\n              {msg.reply_context.type === 'text' ? msg.reply_context.msg : `[${msg.reply_context.type}]`}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"msg-content-wrapper\">\n        {renderContent()}\n      </div>\n\n      {/* Time (Simulated or from timestamp) */}\n      <div className=\"msg-time\">\n        {new Date(msg.timestamp * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n      </div>\n\n      {/* Reply Button */}\n      <button\n        className=\"reply-btn\"\n        onClick={() => setReplyTo(msg)}\n        title=\"Reply\"\n      >\n        â†©\n      </button>\n    </div>\n  );\n};\n\nconst ChatWindow = ({ messages, user, setReplyTo, onLoadMore }) => {\n  const chatWindowRef = useRef(null);\n  const scrollSentinelRef = useRef(null);\n  const [shouldAutoScroll, setShouldAutoScroll] = useState(true);\n  const [isLoadingHistory, setIsLoadingHistory] = useState(false);\n\n  // Check if we should auto-scroll before updates\n  const handleScroll = () => {\n    if (chatWindowRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = chatWindowRef.current;\n      const isNearBottom = scrollHeight - scrollTop - clientHeight < 100;\n      setShouldAutoScroll(isNearBottom);\n\n      // Infinite Scroll: Load more when near top\n      if (scrollTop < 50 && !isLoadingHistory && messages.length > 0) {\n        setIsLoadingHistory(true);\n        // Find oldest message timestamp\n        const oldestMsg = messages[0];\n        if (oldestMsg && onLoadMore) {\n          onLoadMore(oldestMsg.timestamp).finally(() => {\n            setIsLoadingHistory(false);\n          });\n        }\n      }\n    }\n  };\n\n  // Effect to handle auto-scrolling\n  useEffect(() => {\n    if (shouldAutoScroll && scrollSentinelRef.current) {\n      scrollSentinelRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages, shouldAutoScroll]);\n\n  return (\n    <div\n      className=\"chat-window\"\n      ref={chatWindowRef}\n      onScroll={handleScroll}\n    >\n      {isLoadingHistory && <div className=\"loading-history\">Loading history...</div>}\n\n      {messages.map((msg, index) => (\n        <Message\n          key={msg.id || `${msg.timestamp}-${index}`}\n          msg={msg}\n          user={user}\n          setReplyTo={setReplyTo}\n        />\n      ))}\n      <div ref={scrollSentinelRef} className=\"chat-spacer\"></div>\n    </div>\n  );\n};\n\nexport default ChatWindow;\n"],"names":["Message","_ref","msg","user","setReplyTo","isMe","_jsxs","className","concat","type","children","reply_context","onClick","_jsx","renderContent","src","alt","style","position","display","controls","href","download","title","bottom","right","background","color","width","height","borderRadius","alignItems","justifyContent","boxShadow","zIndex","filename","split","pop","slice","join","target","rel","direction","text","test","textAlign","Date","timestamp","toLocaleTimeString","hour","minute","_ref2","messages","onLoadMore","chatWindowRef","useRef","scrollSentinelRef","shouldAutoScroll","setShouldAutoScroll","useState","isLoadingHistory","setIsLoadingHistory","useEffect","current","scrollIntoView","behavior","ref","onScroll","handleScroll","scrollTop","scrollHeight","clientHeight","length","oldestMsg","finally","map","index","id"],"ignoreList":[],"sourceRoot":""}