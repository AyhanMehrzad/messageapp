"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[640],{9570:(e,t,n)=>{n.d(t,{N:()=>b});var r=n(579),s=n(5043),i=n(2190),o=n(4930),c=n(293),a=n(2555),l=n(9674),u=n(8676),d=n(1051);function p(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.useCallback(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{let n=!1;const r=t.map(t=>{const r=p(t,e);return n||"function"!==typeof r||(n=!0),r});if(n)return()=>{for(let e=0;e<r.length;e++){const n=r[e];"function"===typeof n?n():p(t[e],null)}}}}(...t),t)}class h extends s.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=(0,u.s)(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=n-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function m(e){let{children:t,isPresent:n,anchorX:i,root:o}=e;const c=(0,s.useId)(),a=(0,s.useRef)(null),l=(0,s.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=(0,s.useContext)(d.Q),p=f(a,null===t||void 0===t?void 0:t.ref);return(0,s.useInsertionEffect)(()=>{const{width:e,height:t,top:r,left:s,right:d}=l.current;if(n||!a.current||!e||!t)return;const p="left"===i?"left: ".concat(s):"right: ".concat(d);a.current.dataset.motionPopId=c;const f=document.createElement("style");u&&(f.nonce=u);const h=null!==o&&void 0!==o?o:document.head;return h.appendChild(f),f.sheet&&f.sheet.insertRule('\n          [data-motion-pop-id="'.concat(c,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat(p,"px !important;\n            top: ").concat(r,"px !important;\n          }\n        ")),()=>{h.contains(f)&&h.removeChild(f)}},[n]),(0,r.jsx)(h,{isPresent:n,childRef:a,sizeRef:l,children:s.cloneElement(t,{ref:p})})}const g=e=>{let{children:t,initial:n,isPresent:i,onExitComplete:c,custom:u,presenceAffectsLayout:d,mode:p,anchorX:f,root:h}=e;const g=(0,o.M)(v),y=(0,s.useId)();let x=!0,w=(0,s.useMemo)(()=>(x=!1,{id:y,initial:n,isPresent:i,custom:u,onExitComplete:e=>{g.set(e,!0);for(const t of g.values())if(!t)return;c&&c()},register:e=>(g.set(e,!1),()=>g.delete(e))}),[i,g,c]);return d&&x&&(w=(0,a.A)({},w)),(0,s.useMemo)(()=>{g.forEach((e,t)=>g.set(t,!1))},[i]),s.useEffect(()=>{!i&&!g.size&&c&&c()},[i]),"popLayout"===p&&(t=(0,r.jsx)(m,{isPresent:i,anchorX:f,root:h,children:t})),(0,r.jsx)(l.t.Provider,{value:w,children:t})};function v(){return new Map}var y=n(8917);const x=e=>e.key||"";function w(e){const t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}const b=e=>{let{children:t,custom:n,initial:a=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:d="sync",propagate:p=!1,anchorX:f="left",root:h}=e;const[m,v]=(0,y.xQ)(p),b=(0,s.useMemo)(()=>w(t),[t]),j=p&&!m?[]:b.map(x),k=(0,s.useRef)(!0),R=(0,s.useRef)(b),C=(0,o.M)(()=>new Map),[N,P]=(0,s.useState)(b),[S,E]=(0,s.useState)(b);(0,c.E)(()=>{k.current=!1,R.current=b;for(let e=0;e<S.length;e++){const t=x(S[e]);j.includes(t)?C.delete(t):!0!==C.get(t)&&C.set(t,!1)}},[S,j.length,j.join("-")]);const M=[];if(b!==N){let e=[...b];for(let t=0;t<S.length;t++){const n=S[t],r=x(n);j.includes(r)||(e.splice(t,0,n),M.push(n))}return"wait"===d&&M.length&&(e=M),E(w(e)),P(b),null}const{forceRender:T}=(0,s.useContext)(i.L);return(0,r.jsx)(r.Fragment,{children:S.map(e=>{const t=x(e),s=!(p&&!m)&&(b===S||j.includes(t));return(0,r.jsx)(g,{isPresent:s,initial:!(k.current&&!a)&&void 0,custom:n,presenceAffectsLayout:u,mode:d,root:h,onExitComplete:s?void 0:()=>{if(!C.has(t))return;C.set(t,!0);let e=!0;C.forEach(t=>{t||(e=!1)}),e&&(null===T||void 0===T||T(),E(R.current),p&&(null===v||void 0===v||v()),l&&l())},anchorX:f,children:e},t)})})}},9640:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var r=n(5043),s=n(9570),i=n(4119),o=n(579);const c=e=>{let{onSend:t,onSocketAction:n}=e;const[c,a]=(0,r.useState)(""),[l,u]=(0,r.useState)(!1),[d,p]=(0,r.useState)(null),[f,h]=(0,r.useState)(0),[m,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)("user"),x=(0,r.useRef)(null),w=(0,r.useRef)(null),b=(0,r.useRef)([]),j=(0,r.useRef)(null),k=(0,r.useRef)(null),R=(0,r.useRef)(null),C=(0,r.useRef)(null),N=(0,r.useRef)(null),P=(0,r.useRef)(null);(0,r.useEffect)(()=>{x.current&&(x.current.style.height="auto",x.current.style.height=x.current.scrollHeight+"px")},[c]);const S=(0,r.useRef)(null);(0,r.useEffect)(()=>()=>{E()},[]);const E=(0,r.useCallback)(()=>{N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),R.current&&(R.current.pause(),R.current.srcObject=null),P.current&&(cancelAnimationFrame(P.current),P.current=null),S.current&&(S.current.close(),S.current=null)},[]),M=()=>{c.trim()&&(t(c),a(""),x.current&&(x.current.style.height="auto",x.current.focus()))},T=()=>{if(R.current&&C.current&&!R.current.paused&&!R.current.ended){C.current.getContext("2d").drawImage(R.current,0,0,C.current.width,C.current.height),P.current=requestAnimationFrame(T)}},W=async e=>{try{let t;E();let n="audio/webm";if("video"===e){const e={video:{facingMode:v},audio:!0},r=await navigator.mediaDevices.getUserMedia(e);if(N.current=r,C.current&&R.current){R.current.srcObject=r,await R.current.play(),C.current.width=R.current.videoWidth,C.current.height=R.current.videoHeight,T();const e=C.current.captureStream(30),s=r.getAudioTracks()[0];s&&e.addTrack(s),t=e,n=(()=>{const e=["video/mp4","video/webm;codecs=h264","video/webm"];for(const t of e)if(MediaRecorder.isTypeSupported(t))return t;return"video/webm"})()}}else{const e=await navigator.mediaDevices.getUserMedia({audio:!0});N.current=e,t=e,n="audio/webm"}const r=new MediaRecorder(t,{mimeType:n});if(w.current=r,"video"===e){const e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host,n="".concat(e,"//").concat(t,"/ws/chat/stream"),s=new WebSocket(n);S.current=s,s.onopen=()=>{console.log("Video Stream Connected"),r.start(100)},s.onerror=e=>{console.error("WebSocket Error",e)},r.ondataavailable=e=>{e.data.size>0&&s.readyState===WebSocket.OPEN&&s.send(e.data)},r.onstop=()=>{s.readyState===WebSocket.OPEN&&s.close(),E()}}else b.current=[],r.ondataavailable=e=>{e.data.size>0&&b.current.push(e.data)},r.onstop=()=>{const t=new Blob(b.current,{type:n});D(t,e,"webm"),E()},r.start();u(!0),p(e),h(0),j.current=setInterval(()=>{h(e=>e+1)},1e3)}catch(t){console.error("Error accessing media devices:",t),alert("Could not access camera/microphone. Please check permissions.")}},A=()=>{w.current&&l&&(w.current.stop(),u(!1),p(null),clearInterval(j.current))},I=()=>{w.current&&l&&(w.current.onstop=null,w.current.stop(),E(),u(!1),p(null),clearInterval(j.current))},D=async function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webm";g(!0);const s=new FormData,i="image"===n?e.name||"image.png":"recording.".concat(r),o=e.name||i;s.append("file",e,o);try{const e=await fetch("/api/upload",{method:"POST",body:s}),r=await e.json();r.url&&t({msg:r.url,type:n})}catch(c){console.error("Upload failed",c),alert("Upload failed.")}finally{g(!1),k.current&&(k.current.value="")}},[L,X]=(0,r.useState)("audio"),U=(0,r.useRef)(0),z=(0,r.useRef)(null),O=(0,r.useRef)(!1),F=(0,r.useRef)(0),H=(0,r.useRef)(0),B={initial:{scale:.8,rotate:-90,opacity:0},animate:{scale:1,rotate:0,opacity:1},exit:{scale:.8,rotate:90,opacity:0},tap:{scale:.9}};return(0,o.jsxs)("div",{className:"message-input-stack",children:[(0,o.jsx)(s.N,{children:l&&(0,o.jsxs)(i.P.div,{className:"input-container recording-mode",initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},children:[(0,o.jsx)("video",{ref:R,style:{display:"none"},playsInline:!0,muted:!0,autoPlay:!0}),"video"===d&&(0,o.jsxs)("div",{className:"video-preview-circle-container",children:[(0,o.jsx)("canvas",{ref:C,className:"video-preview-feed-circle",style:{transform:"user"===v?"scaleX(-1)":"none"}}),(0,o.jsx)("div",{className:"recording-pulse-border"})]}),(0,o.jsxs)("div",{className:"recording-status",children:[(0,o.jsx)("span",{className:"rec-dot"}),(0,o.jsx)("span",{className:"rec-time",children:(e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n<10?"0":"").concat(n)})(f)}),O.current&&(0,o.jsx)("span",{className:"rec-locked",children:"\ud83d\udd12 Locked"})]}),(0,o.jsxs)("div",{className:"recording-controls",children:[(0,o.jsx)("button",{className:"btn-cancel-rec",onClick:I,children:"Cancel"}),(0,o.jsx)("button",{className:"btn-send-rec",onClick:A,children:"Stop & Send"})]})]})}),!l&&(0,o.jsxs)("div",{className:"input-pill-container",children:[(0,o.jsx)(s.N,{mode:"wait",children:c.startsWith("/")?(0,o.jsx)(i.P.button,{className:"pin-btn bot-cmd-btn",onClick:()=>{},initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:300,damping:20},style:{color:"#3390ec"},children:"\ud83e\udd16"},"bot-cmd"):(0,o.jsx)(i.P.button,{className:"pin-btn",onClick:()=>k.current.click(),whileTap:{scale:.9},initial:{scale:0,rotate:180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:-180},transition:{type:"spring",stiffness:300,damping:20},children:"\ud83d\udcce"},"attach")}),(0,o.jsxs)("div",{className:"input-pill-box",children:[(0,o.jsx)("textarea",{ref:x,className:"input-field-pill",placeholder:"Message...",value:c,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},rows:1,disabled:m}),(0,o.jsx)(s.N,{mode:"popLayout",children:c.trim()?(0,o.jsx)(i.P.button,{className:"send-btn-pill",onClick:M,variants:B,initial:"initial",animate:"animate",exit:"exit",whileTap:"tap",transition:{type:"spring",stiffness:300,damping:20},children:"\u27a4"},"send"):(0,o.jsx)(i.P.div,{className:"media-gesture-btn",onPointerDown:e=>{U.current=Date.now(),O.current=!1,F.current=e.clientY,H.current=e.clientX,z.current=setTimeout(()=>{W(L)},200)},onPointerUp:e=>{clearTimeout(z.current);const t=Date.now()-U.current;l?O.current||A():t<200&&X(e=>"audio"===e?"video":"audio")},onPointerMove:e=>{if(!l||O.current)return;const t=F.current-e.clientY,n=H.current-e.clientX;t>60&&(O.current=!0),n>60&&I()},onPointerLeave:I,variants:B,initial:"initial",animate:"animate",exit:"exit",whileTap:"tap",transition:{type:"spring",stiffness:300,damping:20},style:{cursor:"pointer",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"},children:"audio"===L?"\ud83c\udfa4":"\ud83d\udcf9"},"media")})]})]}),(0,o.jsx)("input",{type:"file",ref:k,style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){let e="file",n=t.name.split(".").pop();t.type.startsWith("image/")?e="image":t.type.startsWith("video/")?e="video":t.type.startsWith("audio/")&&(e="audio"),D(t,e,n)}},accept:"image/*,video/*,audio/*"})]})}}}]);
//# sourceMappingURL=640.49f42bfb.chunk.js.map