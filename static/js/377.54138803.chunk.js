"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[377],{3377:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var s=n(5043),r=n(4930),o=n(293),i=n(9565),c=n(3077),l=n(7070);function a(e,t){[...t].reverse().forEach(n=>{const s=e.getVariant(n);s&&(0,c.U)(e,s),e.variantChildren&&e.variantChildren.forEach(e=>{a(e,t)})})}function u(){let e=!1;const t=new Set,n={subscribe:e=>(t.add(e),()=>{t.delete(e)}),start(n,s){(0,i.V)(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const r=[];return t.forEach(e=>{r.push((0,l._)(e,n,{transitionOverride:s}))}),Promise.all(r)},set:n=>((0,i.V)(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach(e=>{!function(e,t){Array.isArray(t)?a(e,t):"string"===typeof t?a(e,[t]):(0,c.U)(e,t)}(e,n)})),stop(){t.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>(e=!0,()=>{e=!1,n.stop()})};return n}const d=function(){const e=(0,r.M)(u);return(0,o.E)(e.mount,[]),e};var h=n(7189),f=n(1051);function m(e){const t=(0,r.M)(()=>(0,h.OQ)(e)),{isStatic:n}=(0,s.useContext)(f.Q);if(n){const[,n]=(0,s.useState)(e);(0,s.useEffect)(()=>t.on("change",n),[])}return t}var p=n(6744);var g=n(8412);function x(e,t){const n=m(t()),s=()=>n.set(t());return s(),(0,o.E)(()=>{const t=()=>g.Gt.preRender(s,!1,!0),n=e.map(e=>e.on("change",t));return()=>{n.forEach(e=>e()),(0,g.WG)(s)}}),n}function v(e,t,n,s){if("function"===typeof e)return function(e){h.bt.current=[],e();const t=x(h.bt.current,e);return h.bt.current=void 0,t}(e);const r="function"===typeof t?t:function(){const e=!Array.isArray(arguments.length<=0?void 0:arguments[0]),t=e?0:-1,n=0+t<0||arguments.length<=0+t?void 0:arguments[0+t],s=1+t<0||arguments.length<=1+t?void 0:arguments[1+t],r=2+t<0||arguments.length<=2+t?void 0:arguments[2+t],o=3+t<0||arguments.length<=3+t?void 0:arguments[3+t],i=(0,p.G)(s,r,o);return e?i(n):i}(t,n,s);return Array.isArray(e)?y(e,r):y([e],e=>{let[t]=e;return r(t)})}function y(e,t){const n=(0,r.M)(()=>[]);return x(e,()=>{n.length=0;const s=e.length;for(let t=0;t<s;t++)n[t]=e[t].get();return t(n)})}var j=n(4119),w=n(9570),E=n(579);const C=()=>(0,E.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 20 16",fill:"none",className:"msg-check double",children:[(0,E.jsx)("path",{d:"M13.5 4.5L6.5 11.5L3 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,E.jsx)("path",{d:"M17.5 4.5L10.5 11.5L8 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.6"})]}),N=e=>{let{msg:t,user:n,setReplyTo:r,onContextMenu:o}=e;const i=t.user===n,c=d(),l=m(0),a=(v(l,[-100,0],[0,1]),e=>{let{text:t}=e;const[n,r]=(0,s.useState)(!1);return(0,E.jsx)("span",{className:"spoiler ".concat(n?"revealed":""),onClick:e=>{e.stopPropagation(),r(!0)},children:t})}),u=e=>e.split(/(\|\|.*?\|\|)/g).map((e,t)=>e.startsWith("||")&&e.endsWith("||")?(0,E.jsx)(a,{text:e.slice(2,-2)},t):e);return(0,E.jsx)("div",{className:"message-row",style:{display:"flex",position:"relative",flexDirection:"column",alignItems:i?"flex-end":"flex-start"},children:(0,E.jsxs)(j.P.div,{className:"message ".concat(i?"me":"other"," ").concat(t.type),drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:.5,right:0},onDragEnd:(e,n)=>{n.offset.x<-60?(navigator.vibrate&&navigator.vibrate(10),r(t),c.start({x:0})):c.start({x:0})},animate:c,whileDrag:{scale:.98},children:[(0,E.jsx)(j.P.div,{style:{position:"absolute",right:-40,top:"50%",y:"-50%",opacity:v(l,[-60,0],[1,0])},children:"\u21a9"}),t.reply_context&&(0,E.jsxs)("div",{className:"message-reply-context",children:[(0,E.jsx)("div",{className:"reply-line"}),(0,E.jsxs)("div",{className:"reply-content",children:[(0,E.jsx)("div",{className:"reply-author",children:"Replying to"}),(0,E.jsx)("div",{className:"reply-text",children:"text"===t.reply_context.type?t.reply_context.msg:"[".concat(t.reply_context.type,"]")})]})]}),(0,E.jsx)("div",{className:"msg-content-wrapper",children:(()=>{switch(t.type){case"image":return(0,E.jsx)("img",{src:t.msg,alt:"attachment",className:"msg-image"});case"video":return(0,E.jsxs)("div",{className:"video-msg-wrapper",style:{position:"relative",display:"inline-block"},children:[(0,E.jsx)("video",{src:t.msg,controls:!0,className:"msg-video"}),(0,E.jsx)("a",{href:t.msg,download:!0,className:"video-download-btn",children:"\u2b07"})]});case"audio":return(0,E.jsx)("audio",{src:t.msg,controls:!0,className:"msg-audio"});case"file":const n=t.msg.split("/").pop().split("_").slice(2).join("_");return(0,E.jsxs)("a",{href:t.msg,target:"_blank",rel:"noopener noreferrer",className:"msg-file",children:["\ud83d\udcc4 ",n||"Download File"]});default:const s=(e=t.msg,/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(e)?"rtl":"ltr");return(0,E.jsx)("div",{className:"msg-text",style:{direction:s,textAlign:"rtl"===s?"right":"left"},children:u(t.msg)})}var e})()}),(0,E.jsxs)("div",{className:"msg-meta",children:[(0,E.jsx)("span",{className:"msg-time",children:new Date(1e3*t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),i&&(0,E.jsx)("span",{className:"msg-status",children:(0,E.jsx)(C,{})})]})]})})},k=e=>{let{messages:t,user:n,setReplyTo:r,onLoadMore:o}=e;const i=(0,s.useRef)(null),c=(0,s.useRef)(null),[l,a]=(0,s.useState)(!0),[u,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{l&&c.current&&c.current.scrollIntoView({behavior:"smooth"})},[t,l]);const[h,f]=(0,s.useState)(null),m=()=>f(null);return(0,s.useEffect)(()=>{const e=()=>f(null);return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]),(0,E.jsxs)("div",{className:"chat-window",ref:i,onScroll:()=>{if(i.current){const{scrollTop:e,scrollHeight:n,clientHeight:s}=i.current;if(a(n-e-s<100),e<50&&!u&&t.length>0){d(!0);const e=t[0];e&&o&&o(e.timestamp).finally(()=>{d(!1)})}}},children:[u&&(0,E.jsx)("div",{className:"loading-history",children:"Loading history..."}),t.map((e,t)=>(0,E.jsx)(N,{msg:e,user:n,setReplyTo:r,onContextMenu:t=>((e,t)=>{e.preventDefault();let n=e.clientX,s=e.clientY;const r=window.innerWidth,o=window.innerHeight;n+150>r&&(n=r-150-10),s+120>o&&(s=o-120-10),f({x:n,y:s,msg:t})})(t,e)},e.id||"".concat(e.timestamp,"-").concat(t))),(0,E.jsx)("div",{ref:c,className:"chat-spacer"}),(0,E.jsx)(w.N,{children:h&&(0,E.jsxs)(j.P.div,{className:"custom-context-menu",style:{top:h.y,left:h.x},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:300,damping:20},children:[(0,E.jsx)("div",{className:"menu-item",onClick:()=>{r(h.msg),m()},children:"\u21a9 Reply"}),(0,E.jsx)("div",{className:"menu-item",onClick:()=>{navigator.clipboard.writeText(h.msg.msg),m()},children:"\ud83d\udccb Copy"}),(0,E.jsx)("div",{className:"menu-item",onClick:()=>m(),children:"\u270f\ufe0f Edit"}),(0,E.jsx)("div",{className:"menu-item",onClick:()=>m(),children:"\u27a1\ufe0f Forward"}),(0,E.jsx)("div",{className:"menu-item delete",onClick:()=>m(),children:"\ud83d\uddd1\ufe0f Delete"})]})})]})}},9570:(e,t,n)=>{n.d(t,{N:()=>w});var s=n(579),r=n(5043),o=n(2190),i=n(4930),c=n(293),l=n(2555),a=n(9674),u=n(8676),d=n(1051);function h(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.useCallback(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{let n=!1;const s=t.map(t=>{const s=h(t,e);return n||"function"!==typeof s||(n=!0),s});if(n)return()=>{for(let e=0;e<s.length;e++){const n=s[e];"function"===typeof n?n():h(t[e],null)}}}}(...t),t)}class m extends r.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=(0,u.s)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=n-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function p(e){let{children:t,isPresent:n,anchorX:o,root:i}=e;const c=(0,r.useId)(),l=(0,r.useRef)(null),a=(0,r.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=(0,r.useContext)(d.Q),h=f(l,null===t||void 0===t?void 0:t.ref);return(0,r.useInsertionEffect)(()=>{const{width:e,height:t,top:s,left:r,right:d}=a.current;if(n||!l.current||!e||!t)return;const h="left"===o?"left: ".concat(r):"right: ".concat(d);l.current.dataset.motionPopId=c;const f=document.createElement("style");u&&(f.nonce=u);const m=null!==i&&void 0!==i?i:document.head;return m.appendChild(f),f.sheet&&f.sheet.insertRule('\n          [data-motion-pop-id="'.concat(c,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat(h,"px !important;\n            top: ").concat(s,"px !important;\n          }\n        ")),()=>{m.contains(f)&&m.removeChild(f)}},[n]),(0,s.jsx)(m,{isPresent:n,childRef:l,sizeRef:a,children:r.cloneElement(t,{ref:h})})}const g=e=>{let{children:t,initial:n,isPresent:o,onExitComplete:c,custom:u,presenceAffectsLayout:d,mode:h,anchorX:f,root:m}=e;const g=(0,i.M)(x),v=(0,r.useId)();let y=!0,j=(0,r.useMemo)(()=>(y=!1,{id:v,initial:n,isPresent:o,custom:u,onExitComplete:e=>{g.set(e,!0);for(const t of g.values())if(!t)return;c&&c()},register:e=>(g.set(e,!1),()=>g.delete(e))}),[o,g,c]);return d&&y&&(j=(0,l.A)({},j)),(0,r.useMemo)(()=>{g.forEach((e,t)=>g.set(t,!1))},[o]),r.useEffect(()=>{!o&&!g.size&&c&&c()},[o]),"popLayout"===h&&(t=(0,s.jsx)(p,{isPresent:o,anchorX:f,root:m,children:t})),(0,s.jsx)(a.t.Provider,{value:j,children:t})};function x(){return new Map}var v=n(8917);const y=e=>e.key||"";function j(e){const t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}const w=e=>{let{children:t,custom:n,initial:l=!0,onExitComplete:a,presenceAffectsLayout:u=!0,mode:d="sync",propagate:h=!1,anchorX:f="left",root:m}=e;const[p,x]=(0,v.xQ)(h),w=(0,r.useMemo)(()=>j(t),[t]),E=h&&!p?[]:w.map(y),C=(0,r.useRef)(!0),N=(0,r.useRef)(w),k=(0,i.M)(()=>new Map),[b,L]=(0,r.useState)(w),[R,P]=(0,r.useState)(w);(0,c.E)(()=>{C.current=!1,N.current=w;for(let e=0;e<R.length;e++){const t=y(R[e]);E.includes(t)?k.delete(t):!0!==k.get(t)&&k.set(t,!1)}},[R,E.length,E.join("-")]);const M=[];if(w!==b){let e=[...w];for(let t=0;t<R.length;t++){const n=R[t],s=y(n);E.includes(s)||(e.splice(t,0,n),M.push(n))}return"wait"===d&&M.length&&(e=M),P(j(e)),L(w),null}const{forceRender:A}=(0,r.useContext)(o.L);return(0,s.jsx)(s.Fragment,{children:R.map(e=>{const t=y(e),r=!(h&&!p)&&(w===R||E.includes(t));return(0,s.jsx)(g,{isPresent:r,initial:!(C.current&&!l)&&void 0,custom:n,presenceAffectsLayout:u,mode:d,root:m,onExitComplete:r?void 0:()=>{if(!k.has(t))return;k.set(t,!0);let e=!0;k.forEach(t=>{t||(e=!1)}),e&&(null===A||void 0===A||A(),P(N.current),h&&(null===x||void 0===x||x()),a&&a())},anchorX:f,children:e},t)})})}}}]);
//# sourceMappingURL=377.54138803.chunk.js.map